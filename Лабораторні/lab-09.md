[Перелік усіх робіт](README.md)
Інструментальні засоби візуального програмування. Лабораторна робота № 9

# Лабораторна робота № 9

## Робота з Cookies та механізмом сесій

## Мета роботи

Освоїти основні моменти при роботі з файлами cookie та механізмом сесій в PHP створювати класи та працювати з екземплярами класів

## Обладнання

Персональний комп'ютер. Пакет програм XAMPP. Текстовий редактор Sublime Text 3 або IDE NetBeans. Web-браузер Chrome, Firefox, Opera

## Хід роботи
1. Впевнитись, що пакет XAMPP встановлено та web-сервер Apache запущений
2. Перейти до каталогу `C:\xampp\htdocs\` та очистити його
3. Існують змінні сесійні (тимчасові) і постійні. Тимчасові існують поки відкритий браузер, постійні - поки не закінчиться термін придатності cookie. PHP надає для встановлення файлу cookie функцію setcookie(). Для цієї функції потрібно до шести аргументів, і вона повинна викликатися до тега html. Для кожного файлу cookie цю функцію потрібно викликати окремо.

```php
	setcookie(name, value, expire, path, domain, security);
```
Опис усіх аргументів
+ name - встановлює ім'я файлу cookie і зберігається в змінній середовища з ім'ям **HTTP_COOKIE_VARS**. Ця змінна використовується для доступу до файлів cookie.
+ value - встановлює значення іменованої змінної і являє собою контент, який ви хочете зберегти.
+ expiry - визначає час зберігання cookie в секундах з 00:00:00 за Гринвічем 1 січня 1970 року. Після закінчення цього часу cookie стане недоступним. Файли cookie видаляються після закриття браузера.
+ path - вказує каталоги, для яких дійсний файл cookie.
+ domain - може використовуватися для вказівки імені домена в дуже великих доменах і має містити не менше двох періодів. Всі файли cookie дійсні тільки для хоста і домену, для яких вони створені.
+ security - може бути встановлено 1, щоб вказати, що файл cookie повинен передаватися тільки через захищене з'єднання HTTPS. В іншому випадку це значення дорівнює 0, і це означає, що файл cookie може передаватися через звичайне з'єднання HTTP.
  
4. У наступному прикладі ми задамо для cookie аргументи name і age, згідно з якими ці файли cookie стануть не дійсні через годину.
```php
<?php
setcookie("name", "Ivan Petrov", time()+3600, "/","", 0);
setcookie("age", "36", time()+3600, "/", "",  0);
?>
<html> 
    <head>
        <title>Налаштування файлів cookie за допомогою PHP</title>
    </head>
    
    <body>
        <?php echo "Cookies встановлені"?>
    </body>
    
</html>
```

5. PHP надає безліч способів доступу до файлів cookie. Найпростіший з них - використовувати змінні `$_COOKIE` або `$HTTP_COOKIE_VARS`. У наступному прикладі ми отримуємо доступ до всіх файлів cookie, що зазначені в наведеному вище прикладі.

```php
<html>
    <head>
        <title>Доступ до файлів cookie за допомомогою PHP</title>
    </head>
    <body>
        <?php
        echo $_COOKIE["name"]. "<br/>";
        
        echo $HTTP_COOKIE_VARS["name"]. "<br/>";
        
        echo $_COOKIE["age"] . "<br/>";
        
        echo $HTTP_COOKIE_VARS["age"] . "<br/>";
        ?>  
    </body>
</html>
```
**Примітка.** Рядки виводу попарно еквівалентні

6. Ви можете використати функцію `isset()`, щоб перевірити, чи встановлений файл cookie.

```php
<html>

<head>
    <title>Доступ до файлів cookie за допомогою PHP</title>
</head>

<body>
    
    <?php
    if(isset($_COOKIE["name"]))
    echo "Вітаємо " . $_COOKIE["name"] . "<br/>";
    
    else
    echo "Не ідентифіковано" . "<br/>";
    ?>
    
</body>
</html>
```

7. Для видалення cookie потрібно викликати `setcookie()` тільки з одним аргуметом name, але цей метод не завжди працює і не є надійним. Краще встановити cookie з вичерпаним періодом дії. 

```php
<?php
setcookie( "name", "", time()- 60, "/","", 0);
setcookie( "age", "", time()- 60, "/","", 0);
?>
<html>
    
    <head>
        <title>Видалення файлів cookie за допомогою PHP</title>
    </head>
    
    <body>
        <?php echo "Cookies видалені" ?>
    </body>
    
</html>
```

8. Індивідуальні завдання:
+ Створити cookie, встановити значення - ваше ім'я. Написати код з перевіркою передачі і виводом даного cookie на екран. Додати текстове поле для виведення значення cookie в ньому.
+ Видалити cookie та оновити браузер.
+ Вивести на екран кількість відвідувань сторінки, використовуючи cookie. Пропонований алгоритм (можливий інший варіант виконання):
    * встановіть змінну для лічильника ($counter), обнуліть її;
    * перевірте, чи встановлений вже cookie, якщо так - то задайте змінній $counter значення cookie;
    * додайте cookie для зберігання кількості відвідувань;
    * нарощуйте лічильник;
    * перевірте, чи встановленый вже cookie, якщо так - то виводите значення cookie.

9. Крім стандартного створення cookie

```php
setcookie("TestCookie", "Ivan", time()+300);
```

існує можливість створення масиву з різних cookie:

```php
while(list($name, $value) = each($_COOKIE)) {
$array[] = $value;
$array[$name] = $value;
}
```

10. Створимо два cookie для зберігання імені та віку. Представимо cookie, як масив з двох елементів

```php
while(list($name, $value)=each($_COOKIE)){
$array[0] = "Иван";
$array[1] = "23";
}
foreach($array as $val){
echo "значенння = " . $val . "<br>";
}
```

11. Дане завдання також можна виконати за допомогою асоціативного масиву:
    
```php
while(list($name, $value) = each($_COOKIE)){
$array["Ivan"] = 23;
}
foreach($array as $k=>$val){
echo "індекс = " . $k . " значенння = " . $val . "<br>";
}
```

Впевніться у правильності виконання цих прикладів

12. При роботі з сесіями розрізняють наступні етапи: 
+ відкриття сесії
+ реєстрація змінних сесії і їх використання
+ закриття сесії

13. Найпростіший спосіб відкриття сесії полягає у використанні функції session_start(), яка викликається на початку PHP-сценарію
14. Після ініціалізації сесії з'являється можливість зберігати інформацію у суперглобальну масиві `$_SESSION`. Створіть файл index.php у якому в масиві `$_SESSION` зберігається змінна і масив.

```php
<?php
// Ініціюємо сесію
session_start();
// Розміщуємо значення в сесію
$_SESSION['name'] = "value";
// Розміщуємо масив в сесію
$arr = array("first", "second", "third");
$_SESSION['arr'] = $arr;
// Виводимо посилання на іншу сторінку
echo "<a href='other.php'>Інша сторінка</a>";
?>
```

15. На сторінках, де відбувається виклик функції `session_start()`, значення даних змінних можна отримати з суперглобального масиву `$_SESSION`. У наступному лістингу наводиться вміст сторінки `other.php`, де беруться дані, раніше поміщені на сторінці `index.php`. 
    
```php
<?php
// Ініціюємо сесію
session_start();
// Виводимо вміст суперглобального масиву $_SESSION
  echo "<pre>";
  print_r($_SESSION);
echo "</pre>";
?>
``` 

Перевірте виведений результат самостійно

16. Після завершення роботи з сесією спочатку потрібно зареєструвати всі змінні сесії, а потім викликати функцію `unset($_SESSION["username"]);`
17. Розглянемо приклад простої сесії, яка працює з трьома сторінками. При відвідуванні користувачем першої сторінки відкривається сесія і реєструється змінна $username. Відповідний код реалізації приведений в лістингу:

```php
<?
session_start();
$_SESSION['username'] = "Ivan";
echo 'Привіт, ' . $_SESSION['username'] . "<br>";
?>
<a href="page2.php">На наступну сторінку</a>
```

18. Після цього, користувач натискає на посилання і потрапляє на сторінку page2.php:
    
```php
<?
session_start();
echo $_SESSION['username'].' , ти перейшов на другу сторінку!';
echo("<br>");
?>
<a href="page3.php">На наступну сторінку</a>
```

19. При натисканні на посилання, користувач потрапляє на сторінку page3.php, при цьому відбувається розреєстрація сеансової змінної і знищення сесії.

```php
<?
session_start();
unset($_SESSION['username']);
echo 'Привет, '.$_SESSION['username'];
/* Тепер ім`я користувача вже не виводиться */
session_destroy();
?>
```
***Примітка***. Після розреєстрації сеансової змінної значення масиву `$_SESSION['username']` вже недоступне

20. Виконати індивідуальні завдання
  + Створити масив даних для зберігання паролів. Значення паролів зберегти в cookie. В html-код додати текстові поля, вивести в них значення паролів.
  + Створити файл `cookie.php` 
    * При першому запиті сторінки `cookie.php` користувачем, виводити фразу «Ласкаво просимо!»
      
      При повторних запитах: 

    * Виводити кількість відвідувань. Наприклад: «Ви зайшли на сторінку 5 разів»
    * Вказувати дату і час останнього перегляду. Наприклад: «Останнє відвідування: 25-10-2019 16:34:45». Використовуйте функцію `date('d/m/Y H:i:s')`
    
    Алгоритм виконання: 

    
    * Ініціалізуйте змінну для підрахунку кількості відвідувань
    * Якщо відповідні дані передавалися через cookie, зберігайте їх в цю змінну
    * Наростити лічильник відвідувань
    * Ініціалізуйте змінну для зберігання значення останнього відвідування сторінки
    * Якщо відповідні дані передавалися через cookie, відфільтруйте їх і збережіть в цю змінну
    * Встановіть відповідні куки (для лічильника і для дати)
    * Виведіть інформацію про кількість відвідувань і дату останнього відвідування
    * Для кожного етапу роботи зробити знімки екрану та додати їх у звіт з описом кожного скіншота
    * Додати програмний код завдання для самомтійного виконання
    * Дати відповіді на контрольні запитання
    * Зберегти звіт у форматі PDF


## Контрольні питання
1. Що таке cookie, місце розташування, час життя?
2. Функція для визначення часу життя cookie
3. Коли необхідно створювати cookie?
4. Яка змінна використовається для доступу до файлів cookie?
5. Які існують етапи при роботі з сесіями?
6. За допомогою якої функції відкривається сесія в PHP?
7. Коли потібно використовувати функцію `session_destroy()`?


